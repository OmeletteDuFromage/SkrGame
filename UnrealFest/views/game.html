<!DOCTYPE html>
<html class="background-image-container" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centered Image with Footer Buttons</title>
</head>

<body>

    <img src="/images/rotate_screen.svg" id="fullscreenImage" class="fullscreen-image">
    <div class="grid-container">
        <img id="team-icon" alt="portrait" class="top-right-image">
        <div id="bg" class="background"></div>
        <img src="/images/black_bg.svg" alt="Black background" class="image-bottom">
        <img src="/images/border.svg" alt="Border" class="image-top">
        <div id="zone" class="zone-container">
            <img id="image-plane" src="/images/plane_top.svg" alt="Border" usemap="#imagemap" class="image-plane">
            <img src="/images/Zones1.svg" id="image-map" alt="Border" usemap="#image-map" class="image-map">
            <map name="image-map" class="image-map-map" id="image-map-map">
            </map>
        </div>
        <img src="/images/text_rules.png" alt="Top Left Image" class="top-left-image">
        <button id="bottom-right-button" class="bottom-right-button">
            <img src="/images/switch_view.svg" alt="Button Image">
        </button>
    </div>
</body>
<style>
    body,
    html {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        height: 100%;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        /* Prevent scrolling */
    }

    .grid-container {
        height: 100%;
        width: 100%;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .zone-container {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        /* Adjust as needed */
        height: 100%;
        /* Adjust as needed */
        position: relative;
        z-index: 2;
    }

    .fullscreen-image {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-image: url('images/background.svg');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        z-index: 9999;
        display: none;
    }

    .top-right-image {
        position: absolute;
        top: 10px;
        right: 10px;
        max-width: 30%;
        /* Adjust this value to make the image bigger */
        height: auto;
        z-index: 5;
    }

    .image-plane,
    .image-map {
        position: absolute;
        object-fit: contain;
        height: 100%;
        /* Ensure the image scales properly */
        top: 0;
        left: 0;
    }

    .background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #f0f0f0;
        z-index: -1;
    }

    .image-container {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        width: 100vw;
        padding: 20px;
        box-sizing: border-box;
    }

    .image-container img {
        max-width: 100%;
        height: auto;
    }

    .image-bottom {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        object-fit: cover;
        /* Ensure the image covers the entire area */
    }

    .image-top {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2;
        object-fit: cover;
        /* Ensure the image covers the entire area */
    }

    .top-left-image {
        position: absolute;
        top: 10%;
        left: 8%;
        max-width: 20%;
        height: auto;
        z-index: 4;
    }

    .bottom-right-button {
        position: absolute;
        bottom: 1%;
        right: 1%;
        padding: 10px 20px;
        background-color: transparent;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        height: auto;
    }

    @media (orientation: landscape) {
        .top-right-image {
            top: 10px;
            right: 10px;
            max-width: 10%;
        }

        .body {
            width: auto;
            height: auto;
        }

        .top-left-image {
            max-width: 30%;
        }

        .bottom-right-button {
            bottom: 1%;
            right: 1%;
            background-color: transparent;
        }

        .landscape-only {
            display: block;
        }
    }
</style>

</html>



<script>

    function toggleFullscreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(err => {
                alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
            });
        } else {
            document.exitFullscreen();
        }
    }

    function checkOrientation() {
        if (window.innerHeight > window.innerWidth) {
            document.getElementById('fullscreenImage').style.display = 'block';
            document.querySelector('.grid-container').style.display = 'none';
        } else {
            document.getElementById('fullscreenImage').style.display = 'none';
            document.querySelector('.grid-container').style.display = 'block';
        }
    }

    function GetAreas() {
        const image_map = document.getElementById("image-map")
        let areas;
        if (image_map.src.includes('Zones2')) {
            areas = [
                { coords: [52, 185, 237, 252], alt: "Rocket Engine" },
                { coords: [93, 108, 237, 185], alt: "Vertical Tail Plane" },
                { coords: [238, 186, 359, 244], alt: "Oxygen Tank" },
                { coords: [238, 243, 443, 267], alt: "Fuel Tank" },
                { coords: [360, 186, 443, 243], alt: "Methan Tank" },
                { coords: [444, 186, 532, 246], alt: "Cabine" },
                { coords: [532, 186, 577, 246], alt: "Cockpit" },
                { coords: [577, 186, 636, 246], alt: "Nose" }
            ];
        }
        else {
            areas = [
                { coords: [154, 159, 186, 217], alt: "Rocket Engine" },
                { coords: [188, 106, 228, 270], alt: "Horizontal Tail Plane" },
                { coords: [215, 145, 301, 189], alt: "Jet Engine Left" },
                { coords: [214, 190, 301, 233], alt: "Jet Engine Right" },
                { coords: [280, 167, 341, 37], alt: "Left Wing" },
                { coords: [276, 213, 341, 343], alt: "Right Wing" },
                { coords: [301, 168, 341, 210], alt: "Fuel Tank" },
                { coords: [341, 168, 427, 218], alt: "Methan tank" },
                { coords: [428, 159, 473, 218], alt: "Cabine" },
                { coords: [474, 159, 500, 218], alt: "Cockpit" },
                { coords: [499, 159, 542, 218], alt: "Nose" }
            ];
        }
        return areas;
    }

    const originalWidth = 667;
    const originalHeight = 375;
    function scaleCoords(coords, scaleX, scaleY) {
        return coords.map((coord, index) => {
            return index % 2 === 0 ? Math.round(coord * scaleX) : Math.round(coord * scaleY);
        });
    }
    
    function getScaleFactors(element, originalWidth, originalHeight) {
        const rect = element.getBoundingClientRect();
        const scaleX = rect.width / originalWidth;
        const scaleY = rect.height / originalHeight;
        return { scaleX, scaleY };
    }

    function updateMapAreas() {
    checkOrientation()
    const imageMapElement = document.getElementById('image-map');
    const originalWidth = 667;
    const originalHeight = 375;

    const { scaleX, scaleY } = getScaleFactors(imageMapElement, originalWidth, originalHeight);
    const mapElement = document.getElementById('image-map-map');

    mapElement.innerHTML = ''; // Clear existing areas

    
    GetAreas().forEach(area => {
        const scaledCoords = scaleCoords(area.coords, scaleX, scaleY).join(',');
        const areaElement = document.createElement('area');
        areaElement.shape = 'rect';
        areaElement.coords = scaledCoords;
        areaElement.alt = area.alt;
        areaElement.href = '#';
        areaElement.onclick = () => zoneClicked(area.alt);
        mapElement.appendChild(areaElement);
    });
}

    function zoneClicked(ZoneName) {
        fetch('/button-click', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ buttonId: ZoneName })
        })
            .then(response => {
                if (response.ok) {
                } else {
                    console.error('Error sending button click event');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });


    }

    window.addEventListener('resize', updateMapAreas);
    window.addEventListener('load', () => {
        const img = document.getElementById('image-map');
        if (img.complete) {
            updateMapAreas();
        } else {
            img.onload = updateMapAreas;
        }
    });

    const switch_view_button = document.getElementById('bottom-right-button')
    switch_view_button.addEventListener('click', async (event) => {
        const image_plane = document.getElementById("image-plane");
        const map = document.getElementById('image-map');
        if (map.src.includes('Zones2')) {
            image_plane.src = "/images/plane_top.svg";
            map.src = "/images/Zones1.svg";
        }
        else {
            image_plane.src = "/images/plane_side.svg";
            map.src = "/images/Zones2.svg";

        }
        updateMapAreas();
    });

    document.querySelectorAll('.grid-container area').forEach(area => {
        area.addEventListener('click', async (event) => {
            const areaId = event.target.id;
            try {
                const response = await fetch('/button-click', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ buttonId: areaId })
                });

                if (response.ok) {
                    const result = await response.text();
                    console.log(result);
                } else {
                    console.error('Error handling button click');
                }
            } catch (error) {
                console.error('Error sending AJAX request:', error);
            }
        });
    });
    document.addEventListener('DOMContentLoaded', (event) => {

        fetch('/get-cookie')
            .then(response => response.json())
            .then(data => {
                const teamicon = document.getElementById("team-icon");
                if (data.team == 0) {
                    teamicon.src = "/images/team_a_portrait.svg"
                }
                else {
                    teamicon.src = "/images/team_b_portrait.svg"
                }
            });
    });
</script>